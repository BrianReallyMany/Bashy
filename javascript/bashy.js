// Generated by CoffeeScript 1.8.0
(function() {
  var BashyOS, BashySprite, DisplayManager, doCanvasHover, doCanvasUnhover, doMenuHover, doMenuUnhover, doTerminalHover, doTerminalUnhover, firstCanvasHover, firstMenuHover, firstTerminalHover, _ref,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  BashyOS = (function() {
    BashyOS.prototype.cwd = '/';

    function BashyOS() {
      this.pwd = __bind(this.pwd, this);
      this.cd = __bind(this.cd, this);
      this.handleTerminalInput = __bind(this.handleTerminalInput, this);
    }

    BashyOS.prototype.handleTerminalInput = function(input) {
      var fields, stderr, stdout, _ref;
      _ref = ["", ""], stdout = _ref[0], stderr = _ref[1];
      fields = input.split(/\s+/);
      if (fields.length >= 1) {
        if (fields[0] === 'cd') {
          this.cd(fields);
        } else if (fields[0] === 'pwd') {
          stdout = this.pwd;
        }
      }
      return [this.cwd, stdout, stderr];
    };

    BashyOS.prototype.cd = function(args) {
      if (args.length === 1) {
        return this.cwd = '/home';
      } else if (args.length > 1) {
        return this.cwd = args[1];
      }
    };

    BashyOS.prototype.pwd = function() {
      return this.cwd;
    };

    return BashyOS;

  })();

  DisplayManager = (function() {
    function DisplayManager(bashy_sprite) {
      this.bashy_sprite = bashy_sprite;
      this.update = __bind(this.update, this);
    }

    DisplayManager.prototype.update = function(new_dir) {
      return this.bashy_sprite.goToDir(new_dir);
    };

    return DisplayManager;

  })();

  BashySprite = (function() {
    function BashySprite(sprite) {
      this.sprite = sprite;
      this.sprite.x = 200;
      this.sprite.y = 50;
    }

    BashySprite.prototype.goToDir = function(dir) {
      if (dir === "/") {
        return this.goRoot();
      } else if (dir === "/home") {
        return this.goHome();
      } else if (dir === "/media") {
        return this.goMedia();
      }
    };

    BashySprite.prototype.goRoot = function() {
      this.sprite.x = 200;
      return this.sprite.y = 50;
    };

    BashySprite.prototype.goHome = function() {
      this.sprite.x = 80;
      return this.sprite.y = 180;
    };

    BashySprite.prototype.goMedia = function() {
      this.sprite.x = 390;
      return this.sprite.y = 180;
    };

    BashySprite.prototype.moveLeft = function() {
      if (this.sprite.x > 0) {
        return this.sprite.x -= 48;
      }
    };

    BashySprite.prototype.moveRight = function() {
      var limit;
      limit = 288 - this.sprite.getBounds().width;
      if (this.sprite.x < limit) {
        return this.sprite.x += 48;
      }
    };

    BashySprite.prototype.moveUp = function() {
      if (this.sprite.y > 0) {
        return this.sprite.y -= 48;
      }
    };

    BashySprite.prototype.moveDown = function() {
      var limit;
      limit = 288 - this.sprite.getBounds().height;
      if (this.sprite.y < limit) {
        return this.sprite.y += 48;
      }
    };

    BashySprite.prototype.moveTo = function(x, y) {
      this.sprite.x = x;
      return this.sprite.y = y;
    };

    return BashySprite;

  })();

  window.BashyOS = BashyOS;

  window.BashySprite = BashySprite;

  window.DisplayManager = DisplayManager;

  this.BashyOS = (function() {
    function BashyOS() {}

    return BashyOS;

  })();

  this.BashySprite = (function() {
    function BashySprite() {}

    return BashySprite;

  })();

  this.FileSystem = (function() {
    function FileSystem() {}

    return FileSystem;

  })();

  this.DisplayManager = (function() {
    function DisplayManager() {}

    return DisplayManager;

  })();

  _ref = [true, true, true], firstMenuHover = _ref[0], firstCanvasHover = _ref[1], firstTerminalHover = _ref[2];

  doMenuUnhover = function() {};

  doMenuHover = function() {
    var menuString;
    if (firstMenuHover) {
      menuString = "This is the Menu. It tells you about Tasks you've completed ";
      menuString += "and what Tasks are next. Close this window and click ";
      menuString += "the Menu for more info.";
      alert(menuString);
      return firstMenuHover = false;
    }
  };

  doCanvasHover = function() {
    var canvasString;
    if (firstCanvasHover) {
      canvasString = "This is the Map. It shows you where you are and where you can go.";
      canvasString += " After you close this window, you can click the Map for more info.";
      alert(canvasString);
      return firstCanvasHover = false;
    }
  };

  doCanvasUnhover = function() {};

  doTerminalHover = function() {
    var terminalString;
    if (firstTerminalHover) {
      terminalString = "This is the Terminal. It's where you control Bashy. Type a ";
      terminalString += "command, press Enter, see what happens...";
      alert(terminalString);
      return firstTerminalHover = false;
    }
  };

  doTerminalUnhover = function() {};

  jQuery(function() {
    var bashy_himself, canvas, handleFileLoad, playSound, stage, startGame, tick;
    $("#menu").hover(doMenuHover, doMenuUnhover);
    $("#canvas_div").hover(doCanvasHover, doCanvasUnhover);
    $("#terminal").hover(doTerminalHover, doTerminalUnhover);
    canvas = $("#bashy_canvas")[0];
    stage = new createjs.Stage(canvas);
    bashy_himself = new Image();
    bashy_himself.onload = function() {
      return startGame();
    };
    bashy_himself.src = "assets/bashy_sprite_sheet.png";
    handleFileLoad = (function(_this) {
      return function(event) {
        return console.log("Preloaded:", event.id, event.src);
      };
    })(this);
    playSound = function() {
      return createjs.Sound.play("boing1");
    };
    createjs.Sound.alternateExtensions = ["mp3"];
    createjs.Sound.addEventListener("fileload", handleFileLoad);
    createjs.Sound.registerSound("assets/boing1.mp3", "boing1");
    tick = function() {
      return stage.update();
    };
    return startGame = function() {
      var bashySpriteSheet, bashy_sprite, display_mgr, handleInput, homeText, line1, line2, mediaText, os, rootText, sprite;
      rootText = new createjs.Text("/", "20px Arial", "black");
      rootText.x = 250;
      rootText.y = 120;
      rootText.textBaseline = "alphabetic";
      stage.addChild(rootText);
      homeText = new createjs.Text("/home", "20px Arial", "black");
      homeText.x = 140;
      homeText.y = 235;
      homeText.textBaseline = "alphabetic";
      stage.addChild(homeText);
      mediaText = new createjs.Text("/media", "20px Arial", "black");
      mediaText.x = 340;
      mediaText.y = 235;
      mediaText.textBaseline = "alphabetic";
      stage.addChild(mediaText);
      line1 = new createjs.Shape();
      line1.graphics.setStrokeStyle(1);
      line1.graphics.beginStroke("gray");
      line1.graphics.moveTo(255, 125);
      line1.graphics.lineTo(350, 220);
      line1.graphics.endStroke();
      stage.addChild(line1);
      line2 = new createjs.Shape();
      line2.graphics.setStrokeStyle(1);
      line2.graphics.beginStroke("gray");
      line2.graphics.moveTo(245, 125);
      line2.graphics.lineTo(150, 220);
      line2.graphics.endStroke();
      stage.addChild(line2);
      bashySpriteSheet = new createjs.SpriteSheet({
        images: [bashy_himself],
        frames: {
          width: 64,
          height: 64
        },
        animations: {
          walking: [0, 4, "walking"],
          standing: [0, 0, "standing"]
        }
      });
      sprite = new createjs.Sprite(bashySpriteSheet, 0);
      sprite.gotoAndPlay("walking");
      sprite.currentFrame = 0;
      stage.addChild(sprite);
      bashy_sprite = new BashySprite(sprite);
      createjs.Ticker.addEventListener("tick", tick);
      createjs.Ticker.useRAF = true;
      createjs.Ticker.setFPS(5);
      os = new BashyOS();
      display_mgr = new DisplayManager(bashy_sprite);
      handleInput = function(input) {
        var cwd, stderr, stdout, _ref1;
        _ref1 = os.handleTerminalInput(input), cwd = _ref1[0], stdout = _ref1[1], stderr = _ref1[2];
        display_mgr.update(cwd);
        playSound();
        return stdout;
      };
      return $('#terminal').terminal(handleInput, {
        greetings: "",
        prompt: '> ',
        name: 'test'
      });
    };
  });

}).call(this);
